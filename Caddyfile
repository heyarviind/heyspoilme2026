# HeySpoilMe Caddy Configuration
# Automatic HTTPS with Let's Encrypt

# Frontend + API on main domain
heyspoil.me {
	# API routes - proxy to backend
	handle /api/* {
		reverse_proxy backend:8081
	}
	
	# WebSocket support for /api/ws
	handle /api/ws {
		reverse_proxy backend:8081
	}
	
	# Everything else goes to frontend
	handle {
		reverse_proxy frontend:3001
	}
	
	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy strict-origin-when-cross-origin
	}
	
	# Gzip compression
	encode gzip
	
	# Logs
	log {
		output file /var/log/caddy/frontend.log
	}
}

# Backend API
api.heyspoil.me {
	reverse_proxy backend:8081
	
	# Security headers (CORS handled by backend)
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy strict-origin-when-cross-origin
	}
	
	# Gzip compression
	encode gzip
	
	# Logs
	log {
		output file /var/log/caddy/api.log
	}
}

# Redirect www to non-www
www.heyspoil.me {
	redir https://heyspoil.me{uri} permanent
}


